[gcode_macro _CQGL]
gcode:
    {% if printer.quad_gantry_level.applied == False %}
        {% if "xyz" not in printer.toolhead.homed_axes %}
            _CG28    
        {% endif %}
            QUAD_GANTRY_LEVEL
            RESPOND MSG="Reset Z offset"
            _STATUS_MESSAGE TEXT="Resetting Z offset..." STATUS="HOMING"
            G28 Z
    {% endif %}
    STATUS_READY